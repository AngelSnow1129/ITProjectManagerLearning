<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶æµè§ˆå™¨ - ä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆ</title>
    <!-- MathJax æ•°å­¦å…¬å¼æ¸²æŸ“ - å¿…é¡»åœ¨ marked ä¹‹å‰åŠ è½½ -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            chtml: {
                fontURL: null,  // ç¦ç”¨å¤–éƒ¨å­—ä½“åŠ è½½
                adaptiveCSS: false
            },
            
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="libs/mathjax/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="libs/github-markdown.min.css">
    <script src="libs/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* æ–‡ä»¶åˆ—è¡¨ä¾§è¾¹æ  */
        .file-sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .sidebar-header h1 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .breadcrumb {
            font-size: 0.9em;
            opacity: 0.9;
            word-break: break-all;
        }

        .file-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .file-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .file-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .file-icon {
            font-size: 1.5em;
        }

        .file-name {
            flex: 1;
            word-break: break-all;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 1.5em;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: white;
        }

        .markdown-body {
            max-width: 1000px;
            margin: 0 auto;
        }

        .empty-state {
            text-align: center;
            padding: 100px 20px;
            color: #999;
        }

        .empty-state h2 {
            margin-bottom: 15px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #f5576c;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .file-sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .file-sidebar.show {
                transform: translateX(0);
            }

            .mobile-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1.2em;
                z-index: 999;
            }

            .content-header {
                padding-left: 70px;
            }
        }
    </style>
    <script src="statistics.js"></script>
</head>
<body>
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-toggle" onclick="toggleSidebar()" style="display: none;">â˜°</button>

    <!-- æ–‡ä»¶åˆ—è¡¨ä¾§è¾¹æ  -->
    <div class="file-sidebar" id="fileSidebar">
        <div class="sidebar-header">
            <h1 id="folderName">æ–‡ä»¶æµè§ˆå™¨</h1>
            <div class="breadcrumb" id="breadcrumb">åŠ è½½ä¸­...</div>
        </div>

        <div class="file-list" id="fileList">
            <div class="loading">æ­£åœ¨æ‰«ææ–‡ä»¶...</div>
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
        <div class="content-header">
            <div class="content-title" id="contentTitle">é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹</div>
            <div class="action-buttons">
                <button class="action-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
                <button class="action-btn" onclick="goBack()">â† è¿”å›</button>
            </div>
        </div>

        <div class="content-body" id="contentBody">
            <div class="markdown-body">
                <div class="empty-state">
                    <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©æ–‡ä»¶æŸ¥çœ‹</h2>
                    <p>æ”¯æŒæŸ¥çœ‹ Markdown (.md) æ–‡ä»¶</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPath = '';
        let currentName = '';
        let fileList = [];

        // åˆå§‹åŒ–
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentPath = urlParams.get('path') || '';
            currentName = urlParams.get('name') || 'æ–‡ä»¶æµè§ˆå™¨';
            
            document.getElementById('folderName').textContent = currentName;
            document.getElementById('breadcrumb').textContent = currentPath;
            
            scanFolder();
            
            // ç§»åŠ¨ç«¯é€‚é…
            if (window.innerWidth <= 768) {
                document.querySelector('.mobile-toggle').style.display = 'block';
            }
        };

        // æ‰«ææ–‡ä»¶å¤¹
        async function scanFolder() {
            const fileListDiv = document.getElementById('fileList');
            
            // å°è¯•åŠ è½½content.mdæ–‡ä»¶ï¼ˆæ‰€æœ‰æ–‡ä»¶å¤¹éƒ½ä½¿ç”¨ç»Ÿä¸€çš„content.mdï¼‰
            try {
                const contentPath = `../${currentPath}/content.md`;
                const response = await fetch(contentPath);
                
                if (response.ok) {
                    // å¦‚æœå­˜åœ¨content.mdï¼Œç›´æ¥æ˜¾ç¤º
                    fileList = [
                        { name: 'content.md', type: 'md', path: contentPath }
                    ];
                    
                    let html = `
                        <div class="file-item active" onclick="loadFile('content.md', 0)">
                            <div class="file-icon">ğŸ“„</div>
                            <div class="file-name">content.md</div>
                        </div>
                    `;
                    
                    fileListDiv.innerHTML = html;
                    
                    // è‡ªåŠ¨åŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶
                    loadFile('content.md', 0);
                } else {
                    throw new Error('æœªæ‰¾åˆ°content.mdæ–‡ä»¶');
                }
            } catch (error) {
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°content.mdï¼Œæ˜¾ç¤ºæç¤º
                fileListDiv.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #999;">
                        <p>ğŸ“ æ–‡ä»¶å¤¹è·¯å¾„ï¼š</p>
                        <p style="word-break: break-all; margin-top: 10px;">${currentPath}</p>
                        <p style="margin-top: 20px; color: #f5576c;">æœªæ‰¾åˆ° content.md æ–‡ä»¶</p>
                        <p style="margin-top: 10px;">è¯·ç¡®ä¿æ–‡ä»¶å¤¹ä¸­åŒ…å« content.md æ–‡ä»¶</p>
                    </div>
                `;
            }
        }

        // è·å–æ–‡ä»¶å›¾æ ‡
        function getFileIcon(type) {
            const icons = {
                'md': 'ğŸ“„',
                'pdf': 'ğŸ“•',
                'doc': 'ğŸ“˜',
                'docx': 'ğŸ“˜',
                'xls': 'ğŸ“—',
                'xlsx': 'ğŸ“—',
                'zip': 'ğŸ“¦',
                'folder': 'ğŸ“'
            };
            return icons[type] || 'ğŸ“„';
        }

        // åŠ è½½æ–‡ä»¶
        async function loadFile(fileName, index) {
            document.getElementById('contentTitle').textContent = fileName;
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.file-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            const contentDiv = document.getElementById('contentBody');
            
            // æ ¹æ®æ–‡ä»¶ç±»å‹å¤„ç†
            if (fileName.endsWith('.md')) {
                await loadMarkdownFile(fileName);
            } else {
                contentDiv.innerHTML = `
                    <div class="markdown-body">
                        <div style="text-align: center; padding: 50px; color: #999;">
                            <h2>ğŸ“„ ${fileName}</h2>
                            <p style="margin-top: 20px;">æ­¤æ–‡ä»¶ç±»å‹æš‚ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆ</p>
                            <p>è¯·åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€æŸ¥çœ‹</p>
                        </div>
                    </div>
                `;
            }
            
            // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                document.getElementById('fileSidebar').classList.remove('show');
            }
        }

        // åŠ è½½Markdownæ–‡ä»¶
        async function loadMarkdownFile(fileName) {
            const contentDiv = document.getElementById('contentBody');
            contentDiv.innerHTML = '<div class="markdown-body"><div class="loading">åŠ è½½ä¸­...</div></div>';
            
            try {
                const filePath = `../${currentPath}/${fileName}`;
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
                }
                
                const markdown = await response.text();
                
                // ç­‰å¾…markedåº“åŠ è½½
                await waitForMarked();
                
                // é…ç½®markedé€‰é¡¹
                if (typeof marked !== 'undefined' && marked.setOptions) {
                    marked.setOptions({
                        breaks: true,
                        gfm: true
                    });
                }
                
                const html = marked.parse(markdown);
                contentDiv.innerHTML = `<div class="markdown-body">${html}</div>`;
                
                // ä¿®å¤å›¾ç‰‡è·¯å¾„
                fixImagePaths();
                
                // æ¸²æŸ“æ•°å­¦å…¬å¼
                if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                    MathJax.typesetPromise([contentDiv]).catch((err) => {
                        console.error('æ•°å­¦å…¬å¼æ¸²æŸ“å¤±è´¥:', err);
                    });
                }
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                contentDiv.scrollTop = 0;
                
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="markdown-body">
                        <div class="error">
                            <h2>ğŸ˜• åŠ è½½å¤±è´¥</h2>
                            <p>${error.message}</p>
                            <p style="color: #999; margin-top: 10px;">æ–‡ä»¶è·¯å¾„: ${currentPath}/${fileName}</p>
                            <p style="color: #999; margin-top: 10px;">
                                æç¤ºï¼šè¯·ç¡®ä¿ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è®¿é—®ï¼Œç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶å¯èƒ½æ— æ³•åŠ è½½èµ„æº
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        // ä¿®å¤å›¾ç‰‡è·¯å¾„
        function fixImagePaths() {
            const images = document.querySelectorAll('.markdown-body img');
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src) {
                    let newSrc = src;
                    // ä¿®å¤ä»¥ ./images/ å¼€å¤´çš„è·¯å¾„
                    if (src.startsWith('./images/')) {
                        newSrc = `../${currentPath}/${src.substring(2)}`;
                    }
                    // ä¿®å¤ä»¥ images/ å¼€å¤´çš„è·¯å¾„
                    else if (src.startsWith('images/')) {
                        newSrc = `../${currentPath}/${src}`;
                    }
                    
                    if (newSrc !== src) {
                        img.src = newSrc;
                    }
                    
                    // æ·»åŠ å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†
                    img.onerror = function() {
                        console.error(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${newSrc}`);
                        this.style.border = '2px dashed #f5576c';
                        this.style.padding = '20px';
                        this.alt = `å›¾ç‰‡åŠ è½½å¤±è´¥: ${src}`;
                    };
                    
                    // æ·»åŠ ç‚¹å‡»æŸ¥çœ‹å¤§å›¾
                    img.style.cursor = 'pointer';
                    img.onclick = function() {
                        window.open(this.src, '_blank');
                    };
                }
            });
        }

        // ç­‰å¾…markedåº“åŠ è½½
        function waitForMarked() {
            return new Promise((resolve) => {
                if (typeof marked !== 'undefined') {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (typeof marked !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                }
            });
        }

        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            document.getElementById('fileSidebar').classList.toggle('show');
        }

        // è¿”å›
        function goBack() {
            window.location.href = 'resources.html';
        }
    </script>
</body>
</html>
