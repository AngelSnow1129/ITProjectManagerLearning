<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç« èŠ‚å­¦ä¹  - ä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="marked-fallback.js"></script>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .sidebar-header h1 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .view-tab {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .view-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .view-tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .search-box {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .chapter-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .chapter-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chapter-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .chapter-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chapter-name {
            flex: 1;
        }

        .chapter-stars {
            color: #ffc107;
            font-size: 0.9em;
        }

        .chapter-item.active .chapter-stars {
            color: #fff;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 1.5em;
            color: #333;
        }

        .content-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: white;
        }

        .markdown-body {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }

        /* è¿”å›é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .back-to-top.show {
            display: flex;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .mobile-toggle {
                display: block;
            }

            .content-header {
                padding-left: 70px;
            }
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #f5576c;
        }

        /* å­¦ä¹ è¿›åº¦æ ‡è®° */
        .chapter-item.completed::before {
            content: 'âœ“';
            margin-right: 8px;
            color: #28a745;
            font-weight: bold;
        }

        .chapter-item.active.completed::before {
            color: white;
        }

        /* èµ„æºæ–‡ä»¶å¤¹åˆ—è¡¨ */
        .folder-list {
            padding: 10px;
        }

        .folder-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .folder-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .folder-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* æ–‡ä»¶åˆ—è¡¨ */
        .file-list {
            padding: 10px;
        }

        .file-item {
            padding: 10px 15px;
            margin-bottom: 3px;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .file-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .file-item.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <!-- è¿›åº¦æ¡ -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-toggle" onclick="toggleSidebar()">â˜°</button>

    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>ğŸ“š ç« èŠ‚å­¦ä¹ </h1>
            <div class="view-tabs">
                <button class="view-tab active" data-view="normal" onclick="switchView('normal')">ğŸ“– åŸºç¡€</button>
                <button class="view-tab" data-view="case" onclick="switchView('case')">ğŸ“ æ¡ˆä¾‹</button>
                <button class="view-tab" data-view="resource" onclick="switchView('resource')">ğŸ“š èµ„æ–™</button>
            </div>
        </div>

        <div class="search-box">
            <input type="text" class="search-input" placeholder="æœç´¢ç« èŠ‚..." onkeyup="searchChapters(this.value)">
        </div>

        <div class="chapter-list" id="chapterList">
            <!-- ç« èŠ‚åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
        <div class="content-header">
            <div class="content-title" id="contentTitle">é€‰æ‹©ç« èŠ‚å¼€å§‹å­¦ä¹ </div>
            <div class="content-actions">
                <button class="action-btn" onclick="markAsCompleted()">âœ“ æ ‡è®°å®Œæˆ</button>
                <button class="action-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
                <button class="action-btn" onclick="goHome()">ğŸ  é¦–é¡µ</button>
            </div>
        </div>

        <div class="content-body" id="contentBody">
            <div class="markdown-body">
                <div style="text-align: center; padding: 100px 20px; color: #999;">
                    <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©ç« èŠ‚å¼€å§‹å­¦ä¹ </h2>
                    <p style="margin-top: 20px;">æ”¯æŒä¸‰ç§å­¦ä¹ æ¨¡å¼ï¼šåŸºç¡€çŸ¥è¯†ã€æ¡ˆä¾‹åˆ†æã€æœé›†èµ„æ–™</p>
                </div>
            </div>
        </div>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">â†‘</button>

    <script>
        let currentView = 'normal';
        let currentChapter = null;
        let completedChapters = JSON.parse(localStorage.getItem('completedChapters') || '[]');

        // åˆå§‹åŒ–
        window.onload = function() {
            loadChapterList();
            setupScrollListener();
            
            // ä»URLå‚æ•°åŠ è½½ç« èŠ‚
            const urlParams = new URLSearchParams(window.location.search);
            const chapterId = urlParams.get('chapter');
            const view = urlParams.get('view') || 'normal';
            
            if (view) {
                switchView(view);
            }
            
            if (chapterId) {
                loadChapter(chapterId);
            }
        };

        // åŠ è½½ç« èŠ‚åˆ—è¡¨
        function loadChapterList() {
            const listDiv = document.getElementById('chapterList');
            const config = CONFIG.examTypes.projectmanager;
            
            if (currentView === 'normal') {
                // åŸºç¡€çŸ¥è¯†ç« èŠ‚
                let html = '';
                config.chapters.forEach(chapter => {
                    const stars = 'â­'.repeat(chapter.stars);
                    const completed = completedChapters.includes(chapter.id) ? 'completed' : '';
                    html += `
                        <div class="chapter-item ${completed}" onclick="loadChapter('${chapter.id}')">
                            <div class="chapter-name">${chapter.id}. ${chapter.name}</div>
                            <div class="chapter-stars">${stars}</div>
                        </div>
                    `;
                });
                listDiv.innerHTML = html;
            } else if (currentView === 'case') {
                // æ¡ˆä¾‹åˆ†æ
                let html = '';
                config.caseStudy.folders.forEach(folder => {
                    html += `
                        <div class="folder-item" onclick="loadFolder('${folder.path}', '${folder.name}')">
                            ğŸ“ ${folder.name}
                        </div>
                    `;
                });
                listDiv.innerHTML = html;
            } else if (currentView === 'resource') {
                // æœé›†èµ„æ–™
                let html = '';
                config.resources.folders.forEach(folder => {
                    html += `
                        <div class="folder-item" onclick="loadFolder('${folder.path}', '${folder.name}')">
                            ğŸ“ ${folder.name}
                        </div>
                    `;
                });
                listDiv.innerHTML = html;
            }
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            currentView = view;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.view === view) {
                    tab.classList.add('active');
                }
            });
            
            // é‡æ–°åŠ è½½åˆ—è¡¨
            loadChapterList();
            
            // æ¸…ç©ºå†…å®¹
            document.getElementById('contentTitle').textContent = 'é€‰æ‹©å†…å®¹å¼€å§‹å­¦ä¹ ';
            document.getElementById('contentBody').innerHTML = `
                <div class="markdown-body">
                    <div style="text-align: center; padding: 100px 20px; color: #999;">
                        <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©å†…å®¹å¼€å§‹å­¦ä¹ </h2>
                    </div>
                </div>
            `;
        }

        // åŠ è½½ç« èŠ‚å†…å®¹
        async function loadChapter(chapterId) {
            currentChapter = chapterId;
            const config = CONFIG.examTypes.projectmanager;
            const chapter = config.chapters.find(c => c.id === chapterId);
            
            if (!chapter) return;
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('contentTitle').textContent = `ç¬¬${chapter.id}ç«  - ${chapter.name}`;
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.chapter-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.chapter-item').classList.add('active');
            
            // åŠ è½½å†…å®¹
            const contentDiv = document.getElementById('contentBody');
            contentDiv.innerHTML = '<div class="markdown-body"><div class="loading">åŠ è½½ä¸­...</div></div>';
            
            try {
                const filePath = `../md/åŸºç¡€çŸ¥è¯†/${chapter.folder}/content.md`;
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
                }
                
                const markdown = await response.text();
                
                // ç­‰å¾…markedåº“åŠ è½½
                await waitForMarked();
                
                const html = marked.parse(markdown);
                contentDiv.innerHTML = `<div class="markdown-body">${html}</div>`;
                
                // ä¿®å¤å›¾ç‰‡è·¯å¾„
                fixImagePaths(chapter.folder);
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                contentDiv.scrollTop = 0;
                
                // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('show');
                }
                
            } catch (error) {
                // æ£€æµ‹æ˜¯å¦æ˜¯ CORS é”™è¯¯
                const isCorsError = error.message.includes('Failed to fetch') || 
                                   error.message.includes('NetworkError') ||
                                   window.location.protocol === 'file:';
                
                if (isCorsError) {
                    contentDiv.innerHTML = `
                        <div class="markdown-body">
                            <div class="error">
                                <h2>âš ï¸ éœ€è¦å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</h2>
                                <p style="color: #666; margin: 20px 0;">
                                    ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶æ— æ³•åŠ è½½å­¦ä¹ å†…å®¹ã€‚
                                </p>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: left; max-width: 600px; margin: 20px auto;">
                                    <h3 style="color: #333; margin-bottom: 15px;">ğŸ“ è§£å†³æ–¹æ³•ï¼š</h3>
                                    <p style="margin: 10px 0;"><strong>Windows ç”¨æˆ·ï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        åŒå‡»è¿è¡Œé¡¹ç›®æ ¹ç›®å½•çš„ <strong>start_server.bat</strong>
                                    </p>
                                    <p style="margin: 15px 0 10px;"><strong>Mac/Linux ç”¨æˆ·ï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        åœ¨ç»ˆç«¯è¿è¡Œï¼š<strong>./start_server.sh</strong>
                                    </p>
                                    <p style="margin: 15px 0 10px;"><strong>æˆ–ä½¿ç”¨ Pythonï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        python -m http.server 8000
                                    </p>
                                    <p style="margin: 15px 0 0; color: #667eea;">
                                        ç„¶åè®¿é—®ï¼š<strong>http://localhost:8000/web/study.html</strong>
                                    </p>
                                </div>
                                <p style="margin-top: 20px; color: #999; font-size: 0.9em;">
                                    è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„ <strong>docs/ç¦»çº¿å­¦ä¹ æŒ‡å—.md</strong>
                                </p>
                            </div>
                        </div>
                    `;
                } else {
                    contentDiv.innerHTML = `
                        <div class="markdown-body">
                            <div class="error">
                                <h2>ğŸ˜• åŠ è½½å¤±è´¥</h2>
                                <p>${error.message}</p>
                                <p style="color: #999; margin-top: 10px;">æ–‡ä»¶è·¯å¾„: ${filePath}</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // åŠ è½½æ–‡ä»¶å¤¹å†…å®¹
        async function loadFolder(folderPath, folderName) {
            document.getElementById('contentTitle').textContent = folderName;
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.folder-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const contentDiv = document.getElementById('contentBody');
            contentDiv.innerHTML = '<div class="markdown-body"><div class="loading">åŠ è½½ä¸­...</div></div>';
            
            try {
                // å°è¯•åŠ è½½content.mdæ–‡ä»¶
                const filePath = `../${folderPath}/content.md`;
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
                }
                
                const markdown = await response.text();
                
                // ç­‰å¾…markedåº“åŠ è½½
                await waitForMarked();
                
                const html = marked.parse(markdown);
                contentDiv.innerHTML = `<div class="markdown-body">${html}</div>`;
                
                // ä¿®å¤å›¾ç‰‡è·¯å¾„
                fixFolderImagePaths(folderPath);
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                contentDiv.scrollTop = 0;
                
                // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('show');
                }
                
            } catch (error) {
                // æ£€æµ‹æ˜¯å¦æ˜¯ CORS é”™è¯¯
                const isCorsError = error.message.includes('Failed to fetch') || 
                                   error.message.includes('NetworkError') ||
                                   window.location.protocol === 'file:';
                
                if (isCorsError) {
                    contentDiv.innerHTML = `
                        <div class="markdown-body">
                            <div class="error">
                                <h2>âš ï¸ éœ€è¦å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</h2>
                                <p style="color: #666; margin: 20px 0;">
                                    ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶æ— æ³•åŠ è½½å­¦ä¹ å†…å®¹ã€‚
                                </p>
                                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: left; max-width: 600px; margin: 20px auto;">
                                    <h3 style="color: #333; margin-bottom: 15px;">ğŸ“ è§£å†³æ–¹æ³•ï¼š</h3>
                                    <p style="margin: 10px 0;"><strong>Windows ç”¨æˆ·ï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        åŒå‡»è¿è¡Œé¡¹ç›®æ ¹ç›®å½•çš„ <strong>start_server.bat</strong>
                                    </p>
                                    <p style="margin: 15px 0 10px;"><strong>Mac/Linux ç”¨æˆ·ï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        åœ¨ç»ˆç«¯è¿è¡Œï¼š<strong>./start_server.sh</strong>
                                    </p>
                                    <p style="margin: 15px 0 10px;"><strong>æˆ–ä½¿ç”¨ Pythonï¼š</strong></p>
                                    <p style="background: white; padding: 10px; border-radius: 5px; font-family: monospace;">
                                        python -m http.server 8000
                                    </p>
                                    <p style="margin: 15px 0 0; color: #667eea;">
                                        ç„¶åè®¿é—®ï¼š<strong>http://localhost:8000/web/study.html</strong>
                                    </p>
                                </div>
                                <p style="margin-top: 20px; color: #999; font-size: 0.9em;">
                                    è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„ <strong>docs/ç¦»çº¿å­¦ä¹ æŒ‡å—.md</strong>
                                </p>
                            </div>
                        </div>
                    `;
                } else {
                    contentDiv.innerHTML = `
                        <div class="markdown-body">
                            <div class="error">
                                <h2>ğŸ˜• åŠ è½½å¤±è´¥</h2>
                                <p>${error.message}</p>
                                <p style="color: #999; margin-top: 10px;">æ–‡ä»¶è·¯å¾„: ${folderPath}/content.md</p>
                                <p style="color: #999; margin-top: 10px;">
                                    æç¤ºï¼šè¯·ç¡®ä¿æ–‡ä»¶å¤¹ä¸­å­˜åœ¨ content.md æ–‡ä»¶
                                </p>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        // ä¿®å¤æ–‡ä»¶å¤¹å›¾ç‰‡è·¯å¾„
        function fixFolderImagePaths(folderPath) {
            const images = document.querySelectorAll('.markdown-body img');
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.startsWith('images/')) {
                    img.src = `../${folderPath}/${src}`;
                }
                
                // æ·»åŠ ç‚¹å‡»æŸ¥çœ‹å¤§å›¾
                img.style.cursor = 'pointer';
                img.onclick = function() {
                    window.open(this.src, '_blank');
                };
            });
        }

        // æœç´¢ç« èŠ‚
        function searchChapters(keyword) {
            const items = document.querySelectorAll('.chapter-item, .folder-item');
            keyword = keyword.toLowerCase();
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(keyword)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // æ ‡è®°ä¸ºå·²å®Œæˆ
        function markAsCompleted() {
            if (!currentChapter) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç« èŠ‚');
                return;
            }
            
            if (!completedChapters.includes(currentChapter)) {
                completedChapters.push(currentChapter);
                localStorage.setItem('completedChapters', JSON.stringify(completedChapters));
                loadChapterList();
                alert('å·²æ ‡è®°ä¸ºå®Œæˆï¼');
            } else {
                alert('è¯¥ç« èŠ‚å·²ç»æ ‡è®°ä¸ºå®Œæˆ');
            }
        }

        // ä¿®å¤å›¾ç‰‡è·¯å¾„
        function fixImagePaths(chapterFolder) {
            const images = document.querySelectorAll('.markdown-body img');
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.startsWith('images/')) {
                    img.src = `../md/åŸºç¡€çŸ¥è¯†/${chapterFolder}/${src}`;
                }
                
                // æ·»åŠ ç‚¹å‡»æŸ¥çœ‹å¤§å›¾
                img.style.cursor = 'pointer';
                img.onclick = function() {
                    window.open(this.src, '_blank');
                };
            });
        }

        // ç­‰å¾…markedåº“åŠ è½½
        function waitForMarked() {
            return new Promise((resolve) => {
                if (typeof marked !== 'undefined') {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (typeof marked !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                }
            });
        }

        // è®¾ç½®æ»šåŠ¨ç›‘å¬
        function setupScrollListener() {
            const contentBody = document.getElementById('contentBody');
            const backToTop = document.getElementById('backToTop');
            const progressFill = document.getElementById('progressFill');
            
            contentBody.addEventListener('scroll', function() {
                // æ˜¾ç¤º/éšè—è¿”å›é¡¶éƒ¨æŒ‰é’®
                if (contentBody.scrollTop > 300) {
                    backToTop.classList.add('show');
                } else {
                    backToTop.classList.remove('show');
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                const scrollPercent = (contentBody.scrollTop / (contentBody.scrollHeight - contentBody.clientHeight)) * 100;
                progressFill.style.width = scrollPercent + '%';
            });
        }

        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            document.getElementById('contentBody').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
        }

        // è¿”å›é¦–é¡µ
        function goHome() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
