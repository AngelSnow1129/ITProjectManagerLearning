<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦»çº¿å­¦ä¹ æŸ¥çœ‹å™¨ - ä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="marked-fallback.js"></script>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ä¸‰æ å¸ƒå±€ */
        .category-sidebar {
            width: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
        }

        .category-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .category-header h1 {
            font-size: 1.2em;
        }

        .category-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .category-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .category-item.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .folder-sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .folder-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .folder-header h2 {
            font-size: 1.1em;
            color: #333;
        }

        .folder-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .folder-item {
            padding: 10px 12px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .folder-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .folder-item.active {
            background: #667eea;
            color: white;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-header {
            background: white;
            padding: 15px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 1.5em;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: white;
        }

        .markdown-body {
            max-width: 1000px;
            margin: 0 auto;
        }

        .empty-state {
            text-align: center;
            padding: 100px 20px;
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #f5576c;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }

        /* è¿”å›é¡¶éƒ¨ */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
        }

        .back-to-top.show {
            display: flex;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 1024px) {
            .category-sidebar {
                width: 150px;
            }
            
            .folder-sidebar {
                width: 220px;
            }
        }

        @media (max-width: 768px) {
            .category-sidebar,
            .folder-sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .category-sidebar.show,
            .folder-sidebar.show {
                transform: translateX(0);
            }

            .folder-sidebar.show {
                left: 200px;
            }

            .mobile-toggle {
                position: fixed;
                top: 20px;
                left: 20px;
                width: 40px;
                height: 40px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1.2em;
                z-index: 999;
            }

            .content-header {
                padding-left: 70px;
            }
        }
    </style>
    <script src="statistics.js"></script>
</head>
<body>
    <!-- è¿›åº¦æ¡ -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-toggle" onclick="toggleSidebar()" style="display: none;">â˜°</button>

    <!-- åˆ†ç±»ä¾§è¾¹æ  -->
    <div class="category-sidebar" id="categorySidebar">
        <div class="category-header">
            <h1>ğŸ“š å­¦ä¹ èµ„æº</h1>
        </div>
        <div class="category-list">
            <div class="category-item active" data-category="case" onclick="switchCategory('case')">
                ğŸ“ æ¡ˆä¾‹åˆ†æ
            </div>
            <div class="category-item" data-category="resource" onclick="switchCategory('resource')">
                ğŸ“š æœé›†èµ„æ–™
            </div>
            <div class="category-item" data-category="basic" onclick="switchCategory('basic')">
                ğŸ“– åŸºç¡€çŸ¥è¯†
            </div>
        </div>
        <div style="padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);">
            <button class="action-btn" onclick="goHome()" style="width: 100%; background: rgba(255, 255, 255, 0.2);">
                ğŸ  è¿”å›é¦–é¡µ
            </button>
        </div>
    </div>

    <!-- æ–‡ä»¶å¤¹ä¾§è¾¹æ  -->
    <div class="folder-sidebar" id="folderSidebar">
        <div class="folder-header">
            <h2 id="categoryTitle">æ¡ˆä¾‹åˆ†æ</h2>
        </div>
        <div class="folder-list" id="folderList">
            <!-- æ–‡ä»¶å¤¹åˆ—è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
        <div class="content-header">
            <div class="content-title" id="contentTitle">é€‰æ‹©æ–‡ä»¶å¤¹æŸ¥çœ‹å†…å®¹</div>
            <div class="action-buttons">
                <button class="action-btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
                <button class="action-btn" onclick="downloadContent()">ğŸ’¾ ä¿å­˜</button>
            </div>
        </div>

        <div class="content-body" id="contentBody">
            <div class="markdown-body">
                <div class="empty-state">
                    <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©å†…å®¹æŸ¥çœ‹</h2>
                    <p style="margin-top: 15px;">æ”¯æŒæ¡ˆä¾‹åˆ†æã€æœé›†èµ„æ–™ã€åŸºç¡€çŸ¥è¯†ä¸‰å¤§æ¨¡å—</p>
                    <p style="margin-top: 10px; color: #667eea;">å®Œå…¨æ”¯æŒç¦»çº¿å­¦ä¹ </p>
                </div>
            </div>
        </div>
    </div>

    <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">â†‘</button>

    <script>
        let currentCategory = 'case';
        let currentFolder = null;

        // åˆå§‹åŒ–
        window.onload = function() {
            loadFolderList();
            setupScrollListener();
            
            // ç§»åŠ¨ç«¯é€‚é…
            if (window.innerWidth <= 768) {
                document.querySelector('.mobile-toggle').style.display = 'block';
            }
            
            // ä»URLå‚æ•°åŠ è½½
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            const folder = urlParams.get('folder');
            
            if (category) {
                switchCategory(category);
            }
            
            if (folder) {
                // å»¶è¿ŸåŠ è½½ä»¥ç¡®ä¿æ–‡ä»¶å¤¹åˆ—è¡¨å·²ç”Ÿæˆ
                setTimeout(() => {
                    const folderIndex = parseInt(folder);
                    if (!isNaN(folderIndex)) {
                        loadFolderByIndex(folderIndex);
                    }
                }, 100);
            }
        };

        // åˆ‡æ¢åˆ†ç±»
        function switchCategory(category) {
            currentCategory = category;
            
            // æ›´æ–°åˆ†ç±»æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.category === category) {
                    item.classList.add('active');
                }
            });
            
            // æ›´æ–°æ ‡é¢˜
            const titles = {
                'case': 'æ¡ˆä¾‹åˆ†æ',
                'resource': 'æœé›†èµ„æ–™',
                'basic': 'åŸºç¡€çŸ¥è¯†'
            };
            document.getElementById('categoryTitle').textContent = titles[category];
            
            // é‡æ–°åŠ è½½æ–‡ä»¶å¤¹åˆ—è¡¨
            loadFolderList();
            
            // æ¸…ç©ºå†…å®¹
            resetContent();
        }

        // åŠ è½½æ–‡ä»¶å¤¹åˆ—è¡¨
        function loadFolderList() {
            const listDiv = document.getElementById('folderList');
            const config = CONFIG.examTypes.projectmanager;
            
            let html = '';
            let folders = [];
            
            if (currentCategory === 'case') {
                folders = config.caseStudy.folders;
            } else if (currentCategory === 'resource') {
                folders = config.resources.folders;
            } else if (currentCategory === 'basic') {
                folders = config.chapters.map(ch => ({
                    name: `ç¬¬${ch.id}ç«  ${ch.name}`,
                    path: `md/åŸºç¡€çŸ¥è¯†/${ch.folder}`
                }));
            }
            
            folders.forEach((folder, index) => {
                html += `
                    <div class="folder-item" onclick="loadFolder(${index})">
                        ğŸ“ ${folder.name}
                    </div>
                `;
            });
            
            listDiv.innerHTML = html || '<div style="padding: 20px; text-align: center; color: #999;">æš‚æ— å†…å®¹</div>';
        }

        // åŠ è½½æ–‡ä»¶å¤¹å†…å®¹
        async function loadFolder(index) {
            const config = CONFIG.examTypes.projectmanager;
            let folders = [];
            
            if (currentCategory === 'case') {
                folders = config.caseStudy.folders;
            } else if (currentCategory === 'resource') {
                folders = config.resources.folders;
            } else if (currentCategory === 'basic') {
                folders = config.chapters.map(ch => ({
                    name: `ç¬¬${ch.id}ç«  ${ch.name}`,
                    path: `md/åŸºç¡€çŸ¥è¯†/${ch.folder}`
                }));
            }
            
            if (index < 0 || index >= folders.length) return;
            
            const folder = folders[index];
            currentFolder = folder;
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('contentTitle').textContent = folder.name;
            
            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.folder-item').forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // åŠ è½½å†…å®¹
            const contentDiv = document.getElementById('contentBody');
            contentDiv.innerHTML = '<div class="markdown-body"><div class="loading">åŠ è½½ä¸­...</div></div>';
            
            try {
                const filePath = `../${folder.path}/content.md`;
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
                }
                
                const markdown = await response.text();
                
                // ç­‰å¾…markedåº“åŠ è½½
                await waitForMarked();
                
                const html = marked.parse(markdown);
                contentDiv.innerHTML = `<div class="markdown-body">${html}</div>`;
                
                // ä¿®å¤å›¾ç‰‡è·¯å¾„
                fixImagePaths(folder.path);
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                contentDiv.scrollTop = 0;
                
                // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
                if (window.innerWidth <= 768) {
                    document.getElementById('categorySidebar').classList.remove('show');
                    document.getElementById('folderSidebar').classList.remove('show');
                }
                
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="markdown-body">
                        <div class="error">
                            <h2>ğŸ˜• åŠ è½½å¤±è´¥</h2>
                            <p>${error.message}</p>
                            <p style="color: #999; margin-top: 10px;">æ–‡ä»¶è·¯å¾„: ${folder.path}/content.md</p>
                            <p style="color: #999; margin-top: 10px;">
                                æç¤ºï¼šè¯·ç¡®ä¿ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è®¿é—®ï¼Œç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶å¯èƒ½æ— æ³•åŠ è½½èµ„æº
                            </p>
                        </div>
                    </div>
                `;
            }
        }

        // é€šè¿‡ç´¢å¼•åŠ è½½æ–‡ä»¶å¤¹
        function loadFolderByIndex(index) {
            loadFolder(index);
        }

        // ä¿®å¤å›¾ç‰‡è·¯å¾„
        function fixImagePaths(folderPath) {
            const images = document.querySelectorAll('.markdown-body img');
            images.forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.startsWith('images/')) {
                    img.src = `../${folderPath}/${src}`;
                }
                
                // æ·»åŠ ç‚¹å‡»æŸ¥çœ‹å¤§å›¾
                img.style.cursor = 'pointer';
                img.onclick = function() {
                    window.open(this.src, '_blank');
                };
            });
        }

        // ç­‰å¾…markedåº“åŠ è½½
        function waitForMarked() {
            return new Promise((resolve) => {
                if (typeof marked !== 'undefined') {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (typeof marked !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                }
            });
        }

        // è®¾ç½®æ»šåŠ¨ç›‘å¬
        function setupScrollListener() {
            const contentBody = document.getElementById('contentBody');
            const backToTop = document.getElementById('backToTop');
            const progressFill = document.getElementById('progressFill');
            
            contentBody.addEventListener('scroll', function() {
                // æ˜¾ç¤º/éšè—è¿”å›é¡¶éƒ¨æŒ‰é’®
                if (contentBody.scrollTop > 300) {
                    backToTop.classList.add('show');
                } else {
                    backToTop.classList.remove('show');
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                const scrollPercent = (contentBody.scrollTop / (contentBody.scrollHeight - contentBody.clientHeight)) * 100;
                progressFill.style.width = scrollPercent + '%';
            });
        }

        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            document.getElementById('contentBody').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            document.getElementById('categorySidebar').classList.toggle('show');
            document.getElementById('folderSidebar').classList.toggle('show');
        }

        // é‡ç½®å†…å®¹
        function resetContent() {
            document.getElementById('contentTitle').textContent = 'é€‰æ‹©æ–‡ä»¶å¤¹æŸ¥çœ‹å†…å®¹';
            document.getElementById('contentBody').innerHTML = `
                <div class="markdown-body">
                    <div class="empty-state">
                        <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©å†…å®¹æŸ¥çœ‹</h2>
                        <p style="margin-top: 15px;">æ”¯æŒæ¡ˆä¾‹åˆ†æã€æœé›†èµ„æ–™ã€åŸºç¡€çŸ¥è¯†ä¸‰å¤§æ¨¡å—</p>
                    </div>
                </div>
            `;
        }

        // ä¸‹è½½å†…å®¹
        function downloadContent() {
            if (!currentFolder) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶å¤¹');
                return;
            }
            
            const content = document.querySelector('.markdown-body').innerHTML;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentFolder.name}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // è¿”å›é¦–é¡µ
        function goHome() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
